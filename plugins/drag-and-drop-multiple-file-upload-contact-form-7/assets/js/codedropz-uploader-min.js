/**
 * CodeDropz Uploader v1.3.6.4
 * Copyright 2018 Glen Mongaya
 * CodeDrop Drag&Drop Uploader
 * @version 1.3.6.4
 * @author CodeDropz, Glen Don L. Mongaya
 * @license The MIT License (MIT)
 */ // CodeDropz Drag and Drop Plugin
!function($){$.fn.CodeDropz_Uploader=function(a){this.each(function(){var c=$(this),b=$.extend({handler:c,color:"#000",background:"",server_max_error:"Uploaded file exceeds the maximum upload size of your server.",max_file:c.data("max")?c.data("max"):10,max_upload_size:c.data("limit")?c.data("limit"):"10485760",supported_type:c.data("type")?c.data("type"):"jpg|jpeg|JPG|png|gif|pdf|doc|docx|ppt|pptx|odt|avi|ogg|m4a|mov|mp3|mp4|mpg|wav|wmv|xls",text:"Drag & Drop Files Here",separator:"or",button_text:"Browse Files",on_success:""},a),e=c.data("name")+"_count_files";localStorage.setItem(e,1);var f='<div class="codedropz-upload-handler"><div class="codedropz-upload-container"><div class="codedropz-upload-inner"><'+dnd_cf7_uploader.drag_n_drop_upload.tag+">"+b.text+"</"+dnd_cf7_uploader.drag_n_drop_upload.tag+"><span>"+b.separator+'</span><div class="codedropz-btn-wrap"><a class="cd-upload-btn" href="javascript:void(0)">'+b.button_text+'</a></div></div></div><span class="dnd-upload-counter"><span>0</span> '+dnd_cf7_uploader.dnd_text_counter+" "+parseInt(b.max_file)+"</span></div>";b.handler.wrapAll('<div class="codedropz-upload-wrapper"></div>'),b.supported_type=b.supported_type.replace(/[^a-zA-Z0-9| ]/g,"");var g=b.handler.parents("form"),d=b.handler.parents(".codedropz-upload-wrapper"),h=$('input[type="submit"]',g);b.handler.after(f),$(".codedropz-upload-handler",d).on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}),$(".codedropz-upload-handler",d).on("dragover dragenter",function(a){$(this).addClass("codedropz-dragover")}),$(".codedropz-upload-handler",d).on("dragleave dragend drop",function(a){$(this).removeClass("codedropz-dragover")}),$("a.cd-upload-btn",d).on("click",function(a){a.preventDefault(),b.handler.val(null),b.handler.click()}),$(".codedropz-upload-handler",d).on("drop",function(a){i(a.originalEvent.dataTransfer.files,"drop")}),b.handler.on("change",function(a){i(this.files,"click")}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&c.removeAttr("accept");var i=function(f,h){if(!(!f.length>1)){var a=new FormData;a.append("size_limit",b.max_upload_size),a.append("action","dnd_codedropz_upload"),a.append("type",h),a.append("security",dnd_cf7_uploader.ajax_nonce),a.append("form_id",c.data("id")),a.append("upload_name",c.data("name")),$("span.has-error",b.handler).remove(),$.each(f,function(k,f){if(void 0!==a.delete&&a.delete("upload-file"),localStorage.getItem(e)>b.max_file)return!$("span.has-error-msg",d).length>0&&(err_msg=dnd_cf7_uploader.drag_n_drop_upload.max_file_limit,d.append('<span class="has-error-msg">'+err_msg.replace("%count%",b.max_file)+"</span>")),!1;var i=j.createProgressBar(f),h=!1;f.size>b.max_upload_size&&($(".dnd-upload-details",$("#"+i)).append('<span class="has-error d-none">'+dnd_cf7_uploader.drag_n_drop_upload.large_file+"</span>"),d.append('<span class="has-error-msg" id="rekki-error">'+dnd_cf7_uploader.drag_n_drop_upload.large_file+"</span>"),h=!0),regex_type=new RegExp("(.*?).("+b.supported_type+")$"),!1!==h||regex_type.test(f.name.toLowerCase())||($(".dnd-upload-details",$("#"+i)).append('<span class="has-error">'+dnd_cf7_uploader.drag_n_drop_upload.inavalid_type+"</span>"),h=!0),localStorage.setItem(e,Number(localStorage.getItem(e))+1),!1===h&&(a.append("upload-file",f),$.ajax({url:b.ajax_url,type:g.attr("method"),data:a,dataType:"json",cache:!1,contentType:!1,processData:!1,xhr:function(){var a=new window.XMLHttpRequest;return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=parseInt(100*(a.loaded/a.total));j.setProgressBar(i,b-1)}},!1),a},complete:function(){j.setProgressBar(i,100)},success:function(a){a.success?(j.setProgressBar(i,100),$.isFunction(b.on_success)&&b.on_success.call(this,c,i,a)):($(".dnd-progress-bar",$("#"+i)).remove(),$(".dnd-upload-details",$("#"+i)).append('<span class="has-error">'+a.data+"</span>"),$('input[type="submit"]',g).removeClass("disabled").prop("disabled",!1),$("#"+i).removeClass("in-progress"))},error:function(a,c,d){$(".dnd-progress-bar",$("#"+i)).remove(),$(".dnd-upload-details",$("#"+i)).append('<span class="has-error">'+b.server_max_error+"</span>"),$('input[type="submit"]',g).removeClass("disabled").prop("disabled",!1),$("#"+i).removeClass("in-progress")}}))})}},j={createProgressBar:function(a){var c=$(".codedropz-upload-handler",d),b="dnd-file-"+Math.random().toString(36).substr(2,9),f='<div class="dnd-upload-image"><span class="file"></span></div><div class="dnd-upload-details"><span class="name"><span>'+a.name+"</span><em>("+j.bytesToSize(a.size)+')</em></span><a href="javascript:void(0)" title="'+dnd_cf7_uploader.drag_n_drop_upload.delete.title+'" class="remove-file" data-storage="'+e+'"><span class="dnd-icon-remove"></span></a><span class="dnd-progress-bar"><span></span></span></div>';return c.after('<div id="'+b+'" class="dnd-upload-status">'+f+"</div>"),b},setProgressBar:function(c,a){var b=$(".dnd-progress-bar",$("#"+c));return b.length>0&&(j.disableBtn(h),progress_width=a*b.width()/100,$("#"+c).addClass("in-progress"),100==a?$("span",b).width("100%").text(a+"% "):$("span",b).animate({width:progress_width},10).text(a+"% "),100==a&&$("#"+c).addClass("complete").removeClass("in-progress")),!1},bytesToSize:function(a){return 0===a?"0":fileSize=(kBytes=a/1024)>=1024?(kBytes/1024).toFixed(2)+"MB":kBytes.toFixed(2)+"KB"},disableBtn:function(a){a.length>0&&a.addClass("disable").prop("disabled",!0)}}}),$(document).on("click",".dnd-icon-remove",function(e){var b=$(this),c=$("#rekki-error");if(_dnd_status=b.parents(".dnd-upload-status"),_parent_wrap=b.parents(".codedropz-upload-wrapper"),removeStorageData=b.parent("a").attr("data-storage"),storageCount=Number(localStorage.getItem(removeStorageData)),_dnd_status.hasClass("in-progress"))return!1;if($(".has-error",_dnd_status).length>0)return c.remove(),_dnd_status.remove(),localStorage.setItem(removeStorageData,storageCount-1),!1;b.addClass("deleting").text(dnd_cf7_uploader.drag_n_drop_upload.delete.text+"...");var d={path:_dnd_status.find('input[type="hidden"]').val(),action:"dnd_codedropz_upload_delete",security:dnd_cf7_uploader.ajax_nonce};$.post(a.ajax_url,d,function(a){a.success&&(_dnd_status.remove(),localStorage.setItem(removeStorageData,storageCount-1),$(".dnd-upload-status",_parent_wrap).length<=1&&$("span.has-error-msg",_parent_wrap).remove(),$(".dnd-upload-counter span",_parent_wrap).text(Number(localStorage.getItem(removeStorageData))-1))}),$("span.has-error-msg").remove()})}}(jQuery)