"use strict";var WPMailSMTP=window.WPMailSMTP||{};WPMailSMTP.Admin=WPMailSMTP.Admin||{},WPMailSMTP.Admin.Settings=WPMailSMTP.Admin.Settings||{},WPMailSMTP.Admin.Settings.Pro=WPMailSMTP.Admin.Settings.Pro||function(s,t,l){var r=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},p={doingAjax:!1,init:function(){l(p.ready)},ready:function(){p.pageHolder=l(".wp-mail-smtp-tab-settings"),p.bindActions()},bindActions:function(){p.license.bindActions(),p.amazonses.bindActions(),p.amazonses.loadIdentities(),p.multisite.bindActions(),p.webhooks.bindActions()},license:{getNoticeHtml:function(e,t){return'<div class="notice '+e+' wp-mail-smtp-license-notice is-dismissible"><p>'+t+"</p>"},bindActions:function(){p.pageHolder.on("keydown","#wp-mail-smtp-setting-license-key",this.inputEnter),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-verify",this.verify),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-deactivate",this.deactivate),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-refresh",this.refresh)},verify:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),o=l("#wp-mail-smtp-setting-license-key",a),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_verify",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val(),license:o.val()};n.prop("disabled",!0),l.post(ajaxurl,e,function(e){var t,s,i;e.success?(t=e.data.message,s="check-circle-solid-green",i="green",a.find(".type, .desc, #wp-mail-smtp-setting-license-key-deactivate").show(),a.find(".type strong").text(e.data.type),o.prop("disabled",!0)):(t=e.data,s="exclamation-circle-regular-red",i="red",a.find(".type, .desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),o.prop("disabled",!1)),p.license.displayModal(t,s,i),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},inputEnter:function(e){13===e.keyCode&&(e.preventDefault(),l("#wp-mail-smtp-setting-license-key-verify").trigger("click"))},deactivate:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_deactivate",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val()};n.prop("disabled",!0),l.post(ajaxurl,e,function(e){var t,s,i=e.data;e.success?(t="check-circle-solid-green",s="green",a.find("#wp-mail-smtp-setting-license-key").val(""),a.find(".type strong").text("lite"),a.find(".desc, #wp-mail-smtp-setting-license-key-deactivate").hide()):(t="exclamation-circle-regular-red",s="red"),l("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1),p.license.displayModal(i,t,s),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},refresh:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_refresh",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val()};n.prop("disabled",!0),l.post(ajaxurl,e,function(e){var t,s,i;e.success?(t=e.data.message,s="check-circle-solid-green",i="green",a.find(".type strong").text(e.data.type)):(t=e.data,s="exclamation-circle-regular-red",i="red",a.find(".desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),l("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1)),p.license.displayModal(t,s,i),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},displayModal:function(e,t,s){p.displayModal(e,t,s)}},amazonses:{bindActions:function(){l(s).on("click",".js-wp-mail-smtp-providers-amazonses-register-identity",this.processIdentityRegistration),l(s).on("change",".js-wp-mail-smtp-providers-amazonses-register-identity-radio-button",this.processIdentityTypeToggling),l(s).on("click",".js-wp-mail-smtp-ses-dkim-records-copy-btn",this.processTxtCodeCopy),l(s).on("blur","#wp-mail-smtp-providers-amazonses-domain-input",function(){var e=l(this);e.val(e.val().replace("https://","").replace("http://",""))}),l(s).on("keydown","#wp-mail-smtp-providers-amazonses-domain-input, #wp-mail-smtp-providers-amazonses-email-input",function(e){13===e.which&&l(".js-wp-mail-smtp-providers-amazonses-register-identity").trigger("click")}),p.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-register-identity-modal-button",this.openRegisterIdentityModal),p.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-identity-delete",this.processIdentityDelete),p.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-email-resend",this.processEmailResend),p.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-domain-dns-record",this.displayDnsRecord),l("form",p.pageHolder).on("submit",this.maybePreventSettingsSave),l(s).on("focus",".js-wp-mail-smtp-ses-dkim-records-input",function(){l(this).trigger("select")})},loadIdentities:function(){var t,e;"amazonses"!==l(".js-wp-mail-smtp-setting-mailer-radio-input:checked").val()||void 0!==(e=(t=l(".js-wp-mail-smtp-ses-identities-setting")).siblings('input[name="wp_mail_smtp_pro_amazonses_load_ses_identities"]').val())&&e.length&&l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"load_ses_identities",mailer:"amazonses",nonce:e},beforeSend:function(){p.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.html(e.data):t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).fail(function(){t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).always(function(){p.doingAjax=!1})},processIdentityTypeToggling:function(){var e=l(this).closest("#wp-mail-smtp-providers-amazonses-register-identity"),t=e.find("#wp-mail-smtp-providers-amazonses-domain-input"),s=e.find("#wp-mail-smtp-providers-amazonses-domain-desc"),i=e.find("#wp-mail-smtp-providers-amazonses-email-input"),e=e.find("#wp-mail-smtp-providers-amazonses-email-desc");"domain"===this.value?(t.show(),s.show(),i.hide(),e.hide()):(t.hide(),s.hide(),i.show(),e.show())},processIdentityRegistration:function(e){e.preventDefault();var t=l(e.target),s=t.closest("#wp-mail-smtp-providers-amazonses-register-identity"),i=s.find("#wp-mail-smtp-providers-amazonses-domain-input"),n=s.find("#wp-mail-smtp-providers-amazonses-email-input"),a=s.find('input[name="wp_mail_smtp_pro_amazonses_register_identity"]').val(),o=s.find('input[name="identity-type"]:checked').val(),e=("email"===o?n:i).val();return!t.hasClass("disabled")&&("email"!==o||r(e)?void(e.length&&a.length&&l.ajax(p.amazonses.getIdentityRegistrationRequestData(o,e,a,function(){s.find("p.response").remove(),t.html(wp_mail_smtp_pro.loader_white_small).addClass("disabled with-loader"),p.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success&&(i.val(""),n.val(""),p.amazonses.loadIdentities()),s.slideUp(500,function(){s.empty().append(e.data).slideDown(300,function(){l(".js-wp-mail-smtp-btn-close").show()})})}).fail(function(){s.slideUp(500,function(){s.empty().append("<p>"+wp_mail_smtp_pro.ses_text_smth_wrong+"</p>").slideDown(300,function(){l(".js-wp-mail-smtp-btn-close").show()})})}).always(function(){t.removeClass("disabled"),p.doingAjax=!1})):(s.find("p.response").remove(),s.append('<p class="response error">'+wp_mail_smtp_pro.ses_text_email_invalid+"</p>"),!1))},getIdentityRegistrationRequestData:function(e,t,s,i){return{url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_registration",mailer:"amazonses",type:e,value:t,nonce:s},beforeSend:i}},openRegisterIdentityModal:function(e){e.preventDefault(),l.alert({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,closeIcon:!0,type:"blue",boxWidth:"550px",title:wp_mail_smtp_pro.ses_add_identity_modal_title,content:wp_mail_smtp_pro.ses_add_identity_modal_content,buttons:{cancel:{text:wp_mail_smtp_pro.ses_text_done,btnClass:"js-wp-mail-smtp-btn-close btn-hide btn-confirm"}},onOpenBefore:function(){this.$body.addClass("wp-mail-smtp-providers-amazonses-register-identity-modal")}})},processIdentityDelete:function(e){e.preventDefault();var t=l(e.target).closest("a"),s=t.data("identity"),i=t.data("type"),e=t.data("nonce").toString();p.amazonses.deleteIdentity(t,i,s,e)},deleteIdentity:function(e,t,s,i){l.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",boxWidth:"450px",icon:'"></i><img src="'+wp_mail_smtp_pro.plugin_url+'/assets/images/font-awesome/exclamation-circle-solid-orange.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_pro.icon+'"><i class="',title:!1,content:wp_mail_smtp_pro["ses_text_"+t+"_delete"],buttons:{confirm:{text:wp_mail_smtp_pro.ses_text_yes,btnClass:"btn-confirm",keys:["enter"],action:function(){p.amazonses.deleteIdentityAction(e,t,s,i)}},cancel:{text:wp_mail_smtp_pro.ses_text_cancel,btnClass:"btn-cancel"}}})},deleteIdentityAction:function(t,e,s,i){s.length&&i.length&&l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_delete",mailer:"amazonses",value:s,nonce:i},beforeSend:function(){p.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.closest("tr").fadeOut("fast",function(){this.remove()}):alert(e.data)}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){p.doingAjax=!1})},processEmailResend:function(e){e.preventDefault();var t=l(e.target).closest("a"),s=t.data("email"),e=t.data("nonce").toString();return!t.hasClass("disabled")&&(r(s)?void(s.length&&e.length&&l.ajax(p.amazonses.getIdentityRegistrationRequestData("email",s,e,function(){t.addClass("disabled"),t.text(wp_mail_smtp_pro.ses_text_sending),p.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success?t.html('<span class="dashicons dashicons-yes"></span> '+wp_mail_smtp_pro.ses_text_sent).fadeOut(1e3,function(){l(this).text(wp_mail_smtp_pro.ses_text_resend),l(this).fadeIn("fast")}):t.html('<span class="dashicons dashicons-no"></span> '+wp_mail_smtp_pro.ses_text_resend_failed).addClass("error")}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){t.removeClass("disabled"),p.doingAjax=!1})):(alert(wp_mail_smtp_pro.ses_text_smth_wrong),!1))},displayDnsRecord:function(e){e.preventDefault();var e=l(e.target).closest("a"),t=e.data("domain"),s=e.data("nonce");l.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,boxWidth:"550px",content:function(){return p.amazonses.loadDnsRecords(t,s,this)},buttons:{confirm:{text:wp_mail_smtp_pro.ses_text_close,btnClass:"btn-confirm",keys:["enter"]}}})},loadDnsRecords:function(e,t,s){return l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"load_dns_records",domain:e,mailer:"amazonses",nonce:t},beforeSend:function(){p.doingAjax=!0,s.setTitle(wp_mail_smtp_pro.ses_text_loading)}}).done(function(e){e.hasOwnProperty("success")&&e.success?(s.setTitle(wp_mail_smtp_pro.ses_text_dns_dkim_title),s.setType("blue"),s.setIcon(p.getModalIcon("info-circle-blue"))):(s.setTitle(""),s.setType("red"),s.setIcon(p.getModalIcon("exclamation-circle-regular-red"))),s.setContent(e.data)}).fail(function(){s.setTitle(""),s.setType("red"),s.setIcon(p.getModalIcon("exclamation-circle-regular-red")),s.setContent(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){p.doingAjax=!1,s.isOpen()||s.open()})},maybePreventSettingsSave:function(){if(!0===p.doingAjax)return!1},processTxtCodeCopy:function(e){e.preventDefault(),l(this).siblings("input").select(),s.execCommand("Copy");var t=l(this).find(".dashicons");t.removeClass("dashicons-admin-page").addClass("wp-mail-smtp-dashicons-yes-alt-green").fadeOut(1e3,"swing",function(){t.removeClass("wp-mail-smtp-dashicons-yes-alt-green").addClass("dashicons-admin-page").fadeIn(200)})}},webhooks:{bindActions:function(){l(s).on("click",".js-wp-mail-smtp-webhooks-subscribe",this.subscribe),l(s).on("click",".js-wp-mail-smtp-webhooks-unsubscribe",this.unsubscribe)},subscribe:function(e){e.preventDefault();var t=l(this);t.addClass("wp-mail-smtp-loading-spin"),l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_webhooks_subscribe",nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){var t=e.data,s="check-circle-solid-green",i="green";e.success||(s="exclamation-circle-regular-red",i="red"),p.displayModal(t,s,i,function(){return location.reload(),!1})}).fail(function(){p.displayModal(wp_mail_smtp_pro.error_occurred,"exclamation-circle-regular-red","red")}).always(function(){p.doingAjax=!1,t.removeClass("wp-mail-smtp-loading-spin")})},unsubscribe:function(e){e.preventDefault();var t=l(this);t.addClass("wp-mail-smtp-loading-spin"),l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_webhooks_unsubscribe",nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){var t=e.data,s="check-circle-solid-green",i="green";e.success||(s="exclamation-circle-regular-red",i="red"),p.displayModal(t,s,i,function(){return location.reload(),!1})}).fail(function(){p.displayModal(wp_mail_smtp_pro.error_occurred,"exclamation-circle-regular-red","red")}).always(function(){p.doingAjax=!1,t.removeClass("wp-mail-smtp-loading-spin")})}},multisite:{bindActions:function(){l(s).on("click",".js-wp-mail-smtp-clear-network-wide-error-notices",this.clearErrorMessages)},clearErrorMessages:function(e){if(e.preventDefault(),p.doingAjax)return!1;l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_multisite_clear_error_notices",_ajax_nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){if(e.success)return t.location.reload(),!1}).always(function(){p.doingAjax=!1})}},displayModal:function(e,t,s,i){i=i||function(){},l.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,type:s=s||"default",title:!1,icon:t?p.getModalIcon(t):"",content:e,buttons:{confirm:{text:wp_mail_smtp_pro.ok,btnClass:"btn-confirm",keys:["enter"],action:i}},onClose:i})},getModalIcon:function(e){return'"></i><img src="'+wp_mail_smtp_pro.plugin_url+"/assets/images/font-awesome/"+e+'.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_pro.icon+'"><i class="'}};return p}(document,window,jQuery),WPMailSMTP.Admin.Settings.Pro.init();